!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).OnView=t()}(this,function(){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(t,n){return Object.keys(n).forEach(function(e){t[e]=n[e]}),t}function m(e,t,n){return Function('"use strict"; return (function('+(2<arguments.length&&void 0!==n?n:"context")+") { "+e+" });")()(t)}function w(t,e,n){var i,o,r=2<arguments.length&&void 0!==n?n:",";Array.prototype.forEach.call(e.split(r),function(e){switch((e=e.trim())[0]){case"#":e=e.substring(1).replace(" ","-"),t.id=e;break;case".":e=e.substring(1).replace(" ","-"),t.classList.contains(e)||t.classList.add(e);break;case"[":i=e.substring(1,e.indexOf("=")),o=e.substring(i.length+2,e.length-1),i=i.replace(" ","-"),t.setAttribute(i,o)}})}function E(t,e,n){var i,o,r=2<arguments.length&&void 0!==n?n:",";Array.prototype.forEach.call(e.split(r),function(e){switch((e=e.trim())[0]){case"#":e=e.substring(1).replace(" ","-"),t.removeAttribute(e);break;case".":e=e.substring(1).replace(" ","-"),t.classList.contains(e)&&t.classList.remove(e);break;case"[":(i=e.indexOf("="))<0&&(i=e.length-1),o=(o=e.substring(1,i)).replace(" ","-"),t.removeAttribute(o)}})}var e=function(){function o(e){var b=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),r(this,"_initialized",!1),r(this,"_options",void 0),r(this,"_observer",void 0),r(this,"handleIntersect",function(e,g){Array.prototype.forEach.call(e,function(e){b._options.debug&&console.log("OnView: Intersection change triggered for: ",e);var t=b._options.selectorSplitCharacter,n=e.target,i="true"===n.dataset.onviewIsintersecting!=e.isIntersecting;n.dataset.onviewIsintersecting=e.isIntersecting.toString();var o=[];if(n.dataset.onview&&0<n.dataset.onview.length){var r=n.dataset.onview;o.push(function(){return m(r,{entry:e},b._options.eventContextName)})}if(e.isIntersecting){if(n.dataset.onviewEnter){var a=n.dataset.onviewEnter;o.push(function(){return m(a,{entry:e},b._options.eventContextName)}),b.removeFromObserving(n,g,"data-onview-enter")}if(n.dataset.onviewEnterAdd){var s=n.dataset.onviewEnterAdd;o.push(function(){return w(n,s,t)}),b.removeFromObserving(n,g,"data-onview-enter-add")}if(n.dataset.onviewEnterRemove){var c=n.dataset.onviewEnterRemove;o.push(function(){return E(n,c,t)}),b.removeFromObserving(n,g,"data-onview-enter-remove")}}if(n.dataset.onviewEnterToggle)if(e.isIntersecting){var u=n.dataset.onviewEnterToggle;o.push(function(){return w(n,u,t)})}else if(i){var v=n.dataset.onviewEnterToggle;o.push(function(){return E(n,v,t)})}if(i&&!e.isIntersecting){if(n.dataset.onviewExit){var d=n.dataset.onviewExit;o.push(function(){return m(d,{entry:e},b._options.eventContextName)}),b.removeFromObserving(n,g,"data-onview-exit")}if(n.dataset.onviewExitAdd){var l=n.dataset.onviewExitAdd;o.push(function(){return w(n,l,t)}),b.removeFromObserving(n,g,"data-onview-exit-add")}if(n.dataset.onviewExitRemove){var f=n.dataset.onviewExitRemove;o.push(function(){return E(n,f,t)}),b.removeFromObserving(n,g,"data-onview-exit-remove")}}if(n.dataset.onviewExitToggle)if(e.isIntersecting){var h=n.dataset.onviewExitToggle;o.push(function(){return E(n,h,t)})}else if(i){var p=n.dataset.onviewExitToggle;o.push(function(){return w(n,p,t)})}b.delayExecutions(o,n.dataset.onviewDelay),"function"==typeof window.CustomEvent&&n.dispatchEvent(new CustomEvent("onview-change",{detail:{entry:e}}))})}),this._options={debug:!1,readyState:o.READY_STATES.complete,observedElement:document.body,observerElement:null,observerMargin:"0px",eventContextName:"detail",selectorSplitCharacter:"?"},e&&e!=={}&&(this._options=a(this._options,e),this._options.debug&&console.log("OnView: overwriting options, new options:",this._options)),this._options.readyState===o.READY_STATES.interactive?"interactive"===document.readyState||"complete"===document.readyState?this.initialize():document.addEventListener("DOMContentLoaded",function(){b.initialize()}):this._options.readyState===o.READY_STATES.complete&&("complete"===document.readyState?this.initialize():window.addEventListener("load",function(){b.initialize()}))}var e,t,n;return e=o,(t=[{key:"getOptions",value:function(){return a({},this._options)}},{key:"isInitialized",value:function(){return this._initialized}},{key:"initialize",value:function(){this._initialized?this._options.debug&&console.warn("OnView: module instance already initialized, therefore re-initialization is ignored."):(this._initialized=!0,this.setupObserver(),this.queryDocument(),this._options.debug&&console.log("OnView: module instance initialized."))}},{key:"destroy",value:function(){this._observer&&this._observer.disconnect(),this._observer=null,this._initialized=!1,this._options=null}},{key:"queryDocument",value:function(){var t=this,n=this._observer.takeRecords().map(function(e){return e.target}),e=o.ATTRIBUTES.map(function(e){return"["+e+"]"}),i=this._options.observedElement.querySelectorAll(e.join(","));0<n.length?Array.prototype.forEach.call(i,function(e){0<=n.indexOf(e)||t._observer.observe(e)}):Array.prototype.forEach.call(i,function(e){t._observer.observe(e)}),this._options.debug&&console.log("OnView: queried document for elements, observered elements: ",i)}},{key:"setupObserver",value:function(){this._observer&&this._observer.disconnect();var e=a({threshold:0},{root:this._options.observerElement,rootMargin:this._options.observerMargin});this._observer=new IntersectionObserver(this.handleIntersect,e)}},{key:"delayExecutions",value:function(e,t){if(!(e.length<=0))if(t){var n=parseInt(t,10);n<=0?e.forEach(function(e){e()}):setTimeout(function(){e.forEach(function(e){e()})},n)}else e.forEach(function(e){e()})}},{key:"removeFromObserving",value:function(t,e,n){t.dataset.onviewRepeat||(t.removeAttribute(n),0<o.ATTRIBUTES.filter(function(e){return t.hasAttribute(e)}).length||(t.removeAttribute("data-onview-isintersecting"),e.unobserve(t)))}}])&&i(e.prototype,t),n&&i(e,n),o}();return r(e,"READY_STATES",{complete:"complete",interactive:"interactive",never:"never"}),r(e,"ATTRIBUTES",["data-onview","data-onview-enter","data-onview-enter-add","data-onview-enter-remove","data-onview-enter-toggle","data-onview-exit","data-onview-exit-add","data-onview-exit-remove","data-onview-exit-toggle"]),e});
//# sourceMappingURL=onview.umd.min.js.map
