!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).OnView=t()}(this,(function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var t=["data-onview","data-onview-enter","data-onview-enter-add","data-onview-enter-remove","data-onview-enter-toggle","data-onview-exit","data-onview-exit-add","data-onview-exit-remove","data-onview-exit-toggle"];function n(e,t){var n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:",";Array.prototype.forEach.call(t.split(o),(function(t){switch((t=t.trim())[0]){case"#":t=t.substring(1).replace(" ","-"),e.id=t;break;case".":t=t.substring(1).replace(" ","-"),e.classList.contains(t)||e.classList.add(t);break;case"[":n=t.substring(1,t.indexOf("=")),i=t.substring(n.length+2,t.length-1),n=n.replace(" ","-"),e.setAttribute(n,i)}}))}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"context";return Function('"use strict"; return (function('+n+") { "+e+" });")()(t)}function o(e,t){return Object.keys(t).forEach((function(n){e[n]=t[n]})),e}function r(e,t){var n,i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:",";Array.prototype.forEach.call(t.split(o),(function(t){switch((t=t.trim())[0]){case"#":t=t.substring(1).replace(" ","-"),e.removeAttribute(t);break;case".":t=t.substring(1).replace(" ","-"),e.classList.contains(t)&&e.classList.remove(t);break;case"[":(n=t.indexOf("="))<0&&(n=t.length-1),i=(i=t.substring(1,n)).replace(" ","-"),e.removeAttribute(i)}}))}function a(e,n,i){e.dataset.onviewRepeat||(e.removeAttribute(i),t.filter((function(t){return e.hasAttribute(t)})).length>0||(e.removeAttribute("data-onview-isintersecting"),n.unobserve(e)))}var s=function(){function s(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this._initialized=!1,this._options={debug:!1,readyState:s.READY_STATES.complete,observedElement:document.body,observerElement:null,observerMargin:"0px",eventContextName:"detail",selectorSplitCharacter:"?"},e&&e!=={}&&(this._options=o(this._options,e),this._options.debug&&console.log("OnView: overwriting options, new options:",this._options)),this._options.readyState===s.READY_STATES.interactive?"interactive"===document.readyState||"complete"===document.readyState?this.initialize():document.addEventListener("DOMContentLoaded",(function(){t.initialize()})):this._options.readyState===s.READY_STATES.complete&&("complete"===document.readyState?this.initialize():window.addEventListener("load",(function(){t.initialize()})))}var c,u,d;return c=s,(u=[{key:"getOptions",value:function(){return o({},this._options)}},{key:"isInitialized",value:function(){return this._initialized}},{key:"initialize",value:function(){this._initialized?this._options.debug&&console.warn("OnView: module instance already initialized, therefore re-initialization is ignored."):(this._initialized=!0,this._setupObserver(),this.queryDocument(),this._options.debug&&console.log("OnView: module instance initialized."))}},{key:"destroy",value:function(){this._observer&&this._observer.disconnect(),this._observer=null,this._initialized=!1,this._options=null}},{key:"queryDocument",value:function(){var e=this,n=this._observer.takeRecords().map((function(e){return e.target})),i=t.map((function(e){return"["+e+"]"})),o=this._options.observedElement.querySelectorAll(i.join(","));n.length>0?Array.prototype.forEach.call(o,(function(t){n.indexOf(t)>=0||e._observer.observe(t)})):Array.prototype.forEach.call(o,(function(t){e._observer.observe(t)})),this._options.debug&&console.log("OnView: queried document for elements, observered elements: ",o)}},{key:"_setupObserver",value:function(){this._observer&&this._observer.disconnect();var e=o({threshold:0},{root:this._options.observerElement,rootMargin:this._options.observerMargin});this._observer=new IntersectionObserver(this._handleIntersect,e)}},{key:"_handleIntersect",value:function(e,t){var o=this;Array.prototype.forEach.call(e,(function(e){o._options.debug&&console.log("OnView: Intersection change triggered for: ",e);var s=o._options.selectorSplitCharacter,c=e.target,u="true"===c.dataset.onviewIsintersecting!==e.isIntersecting;c.dataset.onviewIsintersecting=e.isIntersecting.toString();var d=[];if(c.dataset.onview&&c.dataset.onview.length>0){var v=c.dataset.onview;d.push((function(){return i(v,{entry:e},o._options.eventContextName)}))}if(e.isIntersecting){if(c.dataset.onviewEnter){var l=c.dataset.onviewEnter;d.push((function(){return i(l,{entry:e},o._options.eventContextName)})),a(c,t,"data-onview-enter")}if(c.dataset.onviewEnterAdd){var f=c.dataset.onviewEnterAdd;d.push((function(){return n(c,f,s)})),a(c,t,"data-onview-enter-add")}if(c.dataset.onviewEnterRemove){var h=c.dataset.onviewEnterRemove;d.push((function(){return r(c,h,s)})),a(c,t,"data-onview-enter-remove")}}if(c.dataset.onviewEnterToggle)if(e.isIntersecting){var p=c.dataset.onviewEnterToggle;d.push((function(){return n(c,p,s)}))}else if(u){var g=c.dataset.onviewEnterToggle;d.push((function(){return r(c,g,s)}))}if(u&&!e.isIntersecting){if(c.dataset.onviewExit){var w=c.dataset.onviewExit;d.push((function(){return i(w,{entry:e},o._options.eventContextName)})),a(c,t,"data-onview-exit")}if(c.dataset.onviewExitAdd){var b=c.dataset.onviewExitAdd;d.push((function(){return n(c,b,s)})),a(c,t,"data-onview-exit-add")}if(c.dataset.onviewExitRemove){var m=c.dataset.onviewExitRemove;d.push((function(){return r(c,m,s)})),a(c,t,"data-onview-exit-remove")}}if(c.dataset.onviewExitToggle)if(e.isIntersecting){var E=c.dataset.onviewExitToggle;d.push((function(){return r(c,E,s)}))}else if(u){var y=c.dataset.onviewExitToggle;d.push((function(){return n(c,y,s)}))}!function(e,t){if(!(e.length<=0))if(t){var n=parseInt(t,10);n<=0?e.forEach((function(e){e()})):setTimeout((function(){e.forEach((function(e){e()}))}),n)}else e.forEach((function(e){e()}))}(d,c.dataset.onviewDelay),"function"==typeof window.CustomEvent&&c.dispatchEvent(new CustomEvent("onview-change",{detail:{entry:e}}))}))}}])&&e(c.prototype,u),d&&e(c,d),s}();return s.READY_STATES={complete:"complete",interactive:"interactive",never:"never"},s}));
